这份功能扩展计划书旨在将 `Baby Timeline` 从一个基础的记录工具，升级为一个**具有引导性、互动性且易于检索**的家庭成长相册。

---

# 🍼 Baby Timeline MVP 功能扩展计划书

## 一、 核心目标
1.  **丰富表达**：支持单篇日记多图展示，完整捕捉精彩瞬间。
2.  **内容引导**：通过“里程碑模板”消除空白期焦虑，引导家长记录关键成长节点。
3.  **高效管理**：提供编辑、删除及搜索功能，确保回忆录的准确性与可检索性。
4.  **仪式感建立**：通过“勋章式”的状态追踪，增强家长记录的成就感。

---

## 二、 详细功能模块设计

### 1. 多图上传与展示模块 (Multi-Photo)
*   **上传增强**：支持一次性选择并上传最多 9 张照片。
*   **智能存储**：每张照片独立存储于 R2，并在数据库中建立 1:N 关联。
*   **瀑布流/网格预览**：前端时间线自动根据照片数量采用不同的布局（单图大图，多图宫格）。

### 2. 日记编辑与照片管理模块 (Management)
*   **深度编辑**：允许修改已发布的日记标题、内容、日期。
*   **照片增删**：
    *   可以在编辑模式下删除单张不满意的照片（同步删除 R2 物理文件）。
    *   可以在原有日记基础上追加新照片。
*   **删除保护**：删除日记时，级联删除所有关联的媒体文件。

### 3. 里程碑模板系统 (Milestone System)
*   **预置内容**：系统内置 10-20 个核心里程碑（如：第一声爸爸、第一次吃辅食、独立行走）。
*   **状态追踪**：
    *   `Pending` (待完成)：显示预置的 AI 占位图和引导性文字，标记为灰色。
    *   `Completed` (已达成)：家长上传真实照片后，条目激活，标记为彩色并记录达成日期。
*   **模板转化**：当家长点击并保存模板时，系统自动将其转换为正式记录。

### 4. 检索与快速导航模块 (Search & Nav)
*   **全文搜索**：支持按关键字模糊搜索日记标题和内容。
*   **里程碑索引页**：一个独立的“勋章墙”视图，集中展示所有里程碑的达成情况，支持点击直达时间线位置。
*   **时间筛选**：支持按月份快速跳转，方便查看宝宝特定月龄的回忆。

---

## 三、 技术实现方案

### 1. 数据库变更 (Supabase)
*   **`entries` 表扩充**：
    *   `type`: `varchar` (值为 `daily` 或 `milestone`)。
    *   `status`: `varchar` (值为 `pending` 或 `completed`)。
*   **`media` 表保持现状**：天然支持 `entry_id` 的一对多关联。

### 2. 后端接口变更 (Worker)
*   `POST /api/upload`: 修改逻辑以支持 `FormData` 中的多文件流处理。
*   `PATCH /api/entry/:id`: 新增接口，用于更新文字内容及转换模板状态。
*   `DELETE /api/media/:id`: 新增接口，用于删除单张图片及其 R2 对象。
*   `GET /api/timeline`: 增加 `search` 和 `filter` 查询参数。

### 3. 前端界面优化
*   **上传组件**：引入多图预览与删除预览图的功能。
*   **时间线组件**：针对 `pending` 状态的模板进行特殊 CSS 渲染（如虚线、黑白滤镜）。
*   **侧边栏/顶栏**：新增搜索框与“里程碑”快捷访问入口。

---

## 四、 实施计划 (Roadmap)

*   **第一阶段 (基础加固)**：
    *   修改数据库表结构。
    *   实现后端多图上传逻辑与前端多图展示。
*   **第二阶段 (编辑功能)**：
    *   开发日记编辑接口与前端编辑弹窗。
    *   实现单张照片的物理删除逻辑。
*   **第三阶段 (里程碑与搜索)**：
    *   导入预置里程碑数据。
    *   开发里程碑状态切换逻辑。
    *   实现前端“勋章墙”与搜索功能。
